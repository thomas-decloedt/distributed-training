[project]
name = "serve"
version = "0.1.0"
description = "Reusable FastAPI serve app delegating to case (mnist, lora)"
requires-python = ">=3.11"
dependencies = [
    "common",
    "fastapi",
    "uvicorn",
    "torch>=2.0",
    "torchvision>=0.15",
]

[project.optional-dependencies]
mnist = ["mnist"]
# lora = ["lora"]  # Separate serve image for lora (CUDA torch conflict with mnist)

[tool.uv.sources]
common = { path = "../common" }
mnist = { path = "../mnist" }
# Force CPU torch for serve; direct deps ensure override applies over mnist's transitive torch
torch = { index = "pytorch-cpu" }
torchvision = { index = "pytorch-cpu" }

[[tool.uv.index]]
name = "pytorch-cpu"
url = "https://download.pytorch.org/whl/cpu"
explicit = true

[build-system]
requires = ["hatchling"]
build-backend = "hatchling.build"

[tool.hatch.build.targets.wheel]
packages = ["src/serve"]
